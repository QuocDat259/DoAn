@using PagedList.Mvc
@using PagedList
@model NhaKhoa.Models.ThoiKhoaBieuViewModel

@{
    ViewBag.Title = "TKB";
    Layout = "~/Areas/Admin/Views/Shared/Layout.cshtml";
    var now = DateTime.Now;

    var daysUntilMonday = ((int)now.DayOfWeek - (int)DayOfWeek.Monday + 7) % 7;
    var monday = now.AddDays(-daysUntilMonday);
    var sunday = monday.AddDays(6);
    int numberweek = 0;
}

<header class="cd-main-header text-center flex flex-column flex-center">
    <h1 class="text-xl">THỜI GIAN BIỂU</h1>
    <a class="btn--primary" href="@Url.Action("ThemThoiKhoaBieu", "QLNhaSi", "Admin")">Thêm lịch làm việc</a>
</header>
<label for="weekSelect">Chọn Tuần:</label>
<select id="weekSelect">
    @foreach (var week in Model.weeks)
    {
        numberweek++;
        var startOfWeek = week;
        var endOfWeek = week.AddDays(6);

        <option value="@startOfWeek.ToString("yyyy-MM-dd")"
                @(startOfWeek == Model.SelectedWeek ? "selected" : "")>
            Tuần @numberweek: @startOfWeek.ToString("dd/MM/yyyy") - @endOfWeek.ToString("dd/MM/yyyy")
        </option>
    }
</select>
<div class="cd-schedule cd-schedule--loading margin-top-lg margin-bottom-lg js-cd-schedule">
    <div class="cd-schedule__timeline">
        <ul>
            <li><span>09:00</span></li>
            <li><span>09:30</span></li>
            <li><span>10:00</span></li>
            <li><span>10:30</span></li>
            <li><span>11:00</span></li>
            <li><span>11:30</span></li>
            <li><span>12:00</span></li>
            <li><span>12:30</span></li>
            <li><span>13:00</span></li>
            <li><span>13:30</span></li>
            <li><span>14:00</span></li>
            <li><span>14:30</span></li>
            <li><span>15:00</span></li>
            <li><span>15:30</span></li>
            <li><span>16:00</span></li>
            <li><span>16:30</span></li>
            <li><span>17:00</span></li>
            <li><span>17:30</span></li>
            <li><span>18:00</span></li>
        </ul>
    </div> <!-- .cd-schedule__timeline -->
    <!-- Your existing code ... -->

    <div id="loadlich">
        @if (Model.DanhSachThu.Any())
        {
            var selectedWeekStartDate = Model.SelectedWeek.Date;
            var selectedWeekEndDate = selectedWeekStartDate.AddDays(6);

            foreach (var day in Model.DanhSachThu)
            {
                <h2>@day.TenThu</h2>
                <ul>
                    @foreach (var eventItem in day.ThoiKhoaBieu
                        .Where(e => e.NgayLamViec.HasValue &&
                                    e.NgayLamViec.Value.Date >= selectedWeekStartDate &&
                                    e.NgayLamViec.Value.Date <= selectedWeekEndDate)
                        .OrderBy(e => e.NgayLamViec))
                    {
                        <li>
                            <span>@eventItem.NgayLamViec.Value.ToString("yyyy-MM-dd HH:mm:ss")</span>
                            <span>@eventItem.KhungGio.GioBatDau - @eventItem.KhungGio.GioKetThuc</span>
                            <span>@eventItem.Phong.TenPhong-@eventItem.KhungGio.TenCa</span>
                            <span>@eventItem.AspNetUsers.FullName</span>
                        </li>
                    }
                </ul>
            }
        }
        else
        {
            <p>No data available for the selected week.</p>
        }
    </div>
</div> <!-- .cd-schedule -->
<!-- Your existing code ... -->
<!-- Your existing HTML code -->
<!-- Your existing HTML code -->

@section scripts {
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script>
        $(document).ready(function () {
            $('#weekSelect').change(function () {
                var selectedWeek = $(this).val();
                window.location.href = "@Url.Action("TKB", "QLNhaSi")" + "?page=1&selectedWeek=" + selectedWeek;
            });
        });
    </script>
}

